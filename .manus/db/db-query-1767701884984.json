{
  "query": "-- تحليل الفروقات - الإيرادات الفعلية مقابل المسجلة\nSELECT \n  er.employeeId,\n  e.name as employeeName,\n  dr.branchId,\n  b.name as branchName,\n  SUM(er.total) as actualRevenue,\n  COALESCE(bd.weeklyRevenue, 0) as registeredRevenue,\n  (SUM(er.total) - COALESCE(bd.weeklyRevenue, 0)) as revenueDiff,\n  COALESCE(bd.bonusAmount, 0) as registeredBonus,\n  bd.bonusTier\nFROM employeeRevenues er\nLEFT JOIN dailyRevenues dr ON er.dailyRevenueId = dr.id\nLEFT JOIN employees e ON er.employeeId = e.id\nLEFT JOIN branches b ON dr.branchId = b.id\nLEFT JOIN weeklyBonuses wb ON wb.branchId = dr.branchId \n  AND wb.weekNumber = 1 AND wb.month = 1 AND wb.year = 2026\nLEFT JOIN bonusDetails bd ON bd.weeklyBonusId = wb.id AND bd.employeeId = er.employeeId\nWHERE dr.date >= '2026-01-01' AND dr.date <= '2026-01-07'\nGROUP BY er.employeeId, e.name, dr.branchId, b.name, bd.weeklyRevenue, bd.bonusAmount, bd.bonusTier\nORDER BY ABS(SUM(er.total) - COALESCE(bd.weeklyRevenue, 0)) DESC;",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 4FCVrv7uyUZp6pM.795ec0267000 --database dsLtTk22LX4iB7jABiF6k8 --execute -- تحليل الفروقات - الإيرادات الفعلية مقابل المسجلة\nSELECT \n  er.employeeId,\n  e.name as employeeName,\n  dr.branchId,\n  b.name as branchName,\n  SUM(er.total) as actualRevenue,\n  COALESCE(bd.weeklyRevenue, 0) as registeredRevenue,\n  (SUM(er.total) - COALESCE(bd.weeklyRevenue, 0)) as revenueDiff,\n  COALESCE(bd.bonusAmount, 0) as registeredBonus,\n  bd.bonusTier\nFROM employeeRevenues er\nLEFT JOIN dailyRevenues dr ON er.dailyRevenueId = dr.id\nLEFT JOIN employees e ON er.employeeId = e.id\nLEFT JOIN branches b ON dr.branchId = b.id\nLEFT JOIN weeklyBonuses wb ON wb.branchId = dr.branchId \n  AND wb.weekNumber = 1 AND wb.month = 1 AND wb.year = 2026\nLEFT JOIN bonusDetails bd ON bd.weeklyBonusId = wb.id AND bd.employeeId = er.employeeId\nWHERE dr.date >= '2026-01-01' AND dr.date <= '2026-01-07'\nGROUP BY er.employeeId, e.name, dr.branchId, b.name, bd.weeklyRevenue, bd.bonusAmount, bd.bonusTier\nORDER BY ABS(SUM(er.total) - COALESCE(bd.weeklyRevenue, 0)) DESC;",
  "rows": [
    {
      "employeeId": "60001",
      "employeeName": "محمد ناصر",
      "branchId": "30001",
      "branchName": "Twiq Branch - Riyadh",
      "actualRevenue": "1050.00",
      "registeredRevenue": "1290.00",
      "revenueDiff": "-240.00",
      "registeredBonus": "35.00",
      "bonusTier": "tier_1"
    },
    {
      "employeeId": "90001",
      "employeeName": "فارس محمد ",
      "branchId": "30001",
      "branchName": "Twiq Branch - Riyadh",
      "actualRevenue": "760.00",
      "registeredRevenue": "945.00",
      "revenueDiff": "-185.00",
      "registeredBonus": "0.00",
      "bonusTier": "none"
    },
    {
      "employeeId": "90003",
      "employeeName": "محمد اسماعيل",
      "branchId": "30001",
      "branchName": "Twiq Branch - Riyadh",
      "actualRevenue": "850.00",
      "registeredRevenue": "1000.00",
      "revenueDiff": "-150.00",
      "registeredBonus": "0.00",
      "bonusTier": "none"
    },
    {
      "employeeId": "90002",
      "employeeName": "عمرو",
      "branchId": "30001",
      "branchName": "Twiq Branch - Riyadh",
      "actualRevenue": "520.00",
      "registeredRevenue": "570.00",
      "revenueDiff": "-50.00",
      "registeredBonus": "0.00",
      "bonusTier": "none"
    },
    {
      "employeeId": "30002",
      "employeeName": "علاء ناصر",
      "branchId": "1",
      "branchName": "Laban",
      "actualRevenue": "1690.00",
      "registeredRevenue": "1675.00",
      "revenueDiff": "15.00",
      "registeredBonus": "60.00",
      "bonusTier": "tier_2"
    },
    {
      "employeeId": "30012",
      "employeeName": "محمود عماره ",
      "branchId": "1",
      "branchName": "Laban",
      "actualRevenue": "1460.00",
      "registeredRevenue": "1460.00",
      "revenueDiff": "0.00",
      "registeredBonus": "35.00",
      "bonusTier": "tier_1"
    },
    {
      "employeeId": "30007",
      "employeeName": "السيد محمد",
      "branchId": "1",
      "branchName": "Laban",
      "actualRevenue": "1315.00",
      "registeredRevenue": "1315.00",
      "revenueDiff": "0.00",
      "registeredBonus": "35.00",
      "bonusTier": "tier_1"
    },
    {
      "employeeId": "30004",
      "employeeName": "عبدالحي جلال",
      "branchId": "1",
      "branchName": "Laban",
      "actualRevenue": "1558.00",
      "registeredRevenue": "1558.00",
      "revenueDiff": "0.00",
      "registeredBonus": "60.00",
      "bonusTier": "tier_2"
    }
  ],
  "messages": [],
  "stdout": "employeeId\temployeeName\tbranchId\tbranchName\tactualRevenue\tregisteredRevenue\trevenueDiff\tregisteredBonus\tbonusTier\n60001\tمحمد ناصر\t30001\tTwiq Branch - Riyadh\t1050.00\t1290.00\t-240.00\t35.00\ttier_1\n90001\tفارس محمد \t30001\tTwiq Branch - Riyadh\t760.00\t945.00\t-185.00\t0.00\tnone\n90003\tمحمد اسماعيل\t30001\tTwiq Branch - Riyadh\t850.00\t1000.00\t-150.00\t0.00\tnone\n90002\tعمرو\t30001\tTwiq Branch - Riyadh\t520.00\t570.00\t-50.00\t0.00\tnone\n30002\tعلاء ناصر\t1\tLaban\t1690.00\t1675.00\t15.00\t60.00\ttier_2\n30012\tمحمود عماره \t1\tLaban\t1460.00\t1460.00\t0.00\t35.00\ttier_1\n30007\tالسيد محمد\t1\tLaban\t1315.00\t1315.00\t0.00\t35.00\ttier_1\n30004\tعبدالحي جلال\t1\tLaban\t1558.00\t1558.00\t0.00\t60.00\ttier_2\n",
  "stderr": "",
  "execution_time_ms": 1514
}