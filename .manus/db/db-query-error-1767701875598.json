{
  "query": "-- تحليل الفروقات بالتفصيل\nWITH ActualRevenues AS (\n  SELECT \n    er.employeeId,\n    e.name as employeeName,\n    dr.branchId,\n    SUM(er.total) as actualRevenue\n  FROM employeeRevenues er\n  LEFT JOIN dailyRevenues dr ON er.dailyRevenueId = dr.id\n  LEFT JOIN employees e ON er.employeeId = e.id\n  WHERE dr.date >= '2026-01-01' AND dr.date <= '2026-01-07'\n  GROUP BY er.employeeId, e.name, dr.branchId\n),\nRegisteredBonus AS (\n  SELECT \n    bd.employeeId,\n    e.name as employeeName,\n    wb.branchId,\n    bd.weeklyRevenue as registeredRevenue,\n    bd.bonusAmount\n  FROM bonusDetails bd\n  LEFT JOIN employees e ON bd.employeeId = e.id\n  LEFT JOIN weeklyBonuses wb ON bd.weeklyBonusId = wb.id\n  WHERE wb.weekNumber = 1 AND wb.month = 1 AND wb.year = 2026\n)\nSELECT \n  COALESCE(a.employeeId, r.employeeId) as employeeId,\n  COALESCE(a.employeeName, r.employeeName) as employeeName,\n  COALESCE(a.branchId, r.branchId) as branchId,\n  COALESCE(a.actualRevenue, 0) as actualRevenue,\n  COALESCE(r.registeredRevenue, 0) as registeredRevenue,\n  (COALESCE(a.actualRevenue, 0) - COALESCE(r.registeredRevenue, 0)) as revenueDiff,\n  COALESCE(r.bonusAmount, 0) as registeredBonus,\n  CASE \n    WHEN ABS(COALESCE(a.actualRevenue, 0) - COALESCE(r.registeredRevenue, 0)) > 1 THEN 'فرق'\n    ELSE 'متطابق'\n  END as status\nFROM ActualRevenues a\nFULL OUTER JOIN RegisteredBonus r ON a.employeeId = r.employeeId AND a.branchId = r.branchId\nORDER BY ABS(COALESCE(a.actualRevenue, 0) - COALESCE(r.registeredRevenue, 0)) DESC;",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 4FCVrv7uyUZp6pM.795ec0267000 --database dsLtTk22LX4iB7jABiF6k8 --execute -- تحليل الفروقات بالتفصيل\nWITH ActualRevenues AS (\n  SELECT \n    er.employeeId,\n    e.name as employeeName,\n    dr.branchId,\n    SUM(er.total) as actualRevenue\n  FROM employeeRevenues er\n  LEFT JOIN dailyRevenues dr ON er.dailyRevenueId = dr.id\n  LEFT JOIN employees e ON er.employeeId = e.id\n  WHERE dr.date >= '2026-01-01' AND dr.date <= '2026-01-07'\n  GROUP BY er.employeeId, e.name, dr.branchId\n),\nRegisteredBonus AS (\n  SELECT \n    bd.employeeId,\n    e.name as employeeName,\n    wb.branchId,\n    bd.weeklyRevenue as registeredRevenue,\n    bd.bonusAmount\n  FROM bonusDetails bd\n  LEFT JOIN employees e ON bd.employeeId = e.id\n  LEFT JOIN weeklyBonuses wb ON bd.weeklyBonusId = wb.id\n  WHERE wb.weekNumber = 1 AND wb.month = 1 AND wb.year = 2026\n)\nSELECT \n  COALESCE(a.employeeId, r.employeeId) as employeeId,\n  COALESCE(a.employeeName, r.employeeName) as employeeName,\n  COALESCE(a.branchId, r.branchId) as branchId,\n  COALESCE(a.actualRevenue, 0) as actualRevenue,\n  COALESCE(r.registeredRevenue, 0) as registeredRevenue,\n  (COALESCE(a.actualRevenue, 0) - COALESCE(r.registeredRevenue, 0)) as revenueDiff,\n  COALESCE(r.bonusAmount, 0) as registeredBonus,\n  CASE \n    WHEN ABS(COALESCE(a.actualRevenue, 0) - COALESCE(r.registeredRevenue, 0)) > 1 THEN 'فرق'\n    ELSE 'متطابق'\n  END as status\nFROM ActualRevenues a\nFULL OUTER JOIN RegisteredBonus r ON a.employeeId = r.employeeId AND a.branchId = r.branchId\nORDER BY ABS(COALESCE(a.actualRevenue, 0) - COALESCE(r.registeredRevenue, 0)) DESC;",
  "returncode": 1,
  "logs": [
    "ERROR 1064 (42000) at line 2: You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 38 column 5 near \"FULL OUTER JOIN RegisteredBonus r ON a.employeeId = r.employeeId AND a.branchId = r.branchId",
    "ORDER BY ABS(COALESCE(a.actualRevenue, 0) - COALESCE(r.registeredRevenue, 0)) DESC\""
  ]
}