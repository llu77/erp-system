# ๐ ุชูุฑูุฑ ุชุญููู ุงูุฏูุงู ุงููุชูุฏูุฉ ููุงุณุชุนูุงู ูุงููุฑุงูุจุฉ

## ๐ ููุฎุต ุชูููุฐู

ุชู ูุฑุงุฌุนุฉ ููู `advanced_queries.ts` ุงูุฐู ูุญุชูู ุนูู **18 ุฏุงูุฉ ูุชูุฏูุฉ** ููุณูุฉ ุฅูู 5 ูุฆุงุช ุฑุฆูุณูุฉ. ูุฐุง ุงูุชูุฑูุฑ ููููู ูู ุฏุงูุฉ ูู ุญูุซ:
- **ุงููุงุฆุฏุฉ ูููุธุงู ุงูุญุงูู**
- **ุงูุชูุงูู ูุน ุงูุจููุฉ ุงูููุฌูุฏุฉ**
- **ุงููุชุทูุจุงุช ุงููุณุจูุฉ ููุชูููุฐ**
- **ุงูุฃููููุฉ ุงูููุชุฑุญุฉ**

---

## ๐ฏ ุงูุชูููู ุงูุฅุฌูุงูู

| ุงููุฆุฉ | ุนุฏุฏ ุงูุฏูุงู | ุงููุงุฆุฏุฉ | ุงูุชูุงูู | ุงูุฃููููุฉ |
|-------|-----------|---------|---------|----------|
| ูุฑุงูุจุฉ ุงููุธุงู | 4 | โญโญโญโญโญ | โ ุนุงูู | ๐ด ุนุงุฌู |
| ุงููุทุงุจูุฉ ูุงูุชุณููุฉ | 3 | โญโญโญโญโญ | โ ุนุงูู | ๐ด ุนุงุฌู |
| ุฅุฏุงุฑุฉ ุณูุฑ ุงูุนูู | 3 | โญโญโญโญ | โ๏ธ ูุชูุณุท | ๐ก ูุชูุณุท |
| ุงูุชุญูููุงุช ูุงูุชูุงุฑูุฑ | 4 | โญโญโญโญโญ | โ ุนุงูู | ๐ข ููู |
| ุงููุฑุงุฌุนุฉ ูุงูุงูุชุซุงู | 4 | โญโญโญโญ | โ๏ธ ูุญุชุงุฌ ุชุนุฏูู | ๐ก ูุชูุณุท |

---

## 1. ๐ ูุฑุงูุจุฉ ุงููุธุงู (System Monitoring)

### 1.1 `checkDatabaseHealth()` โญโญโญโญโญ
**ุงูุบุฑุถ:** ูุญุต ุตุญุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุชูููู:**
- โ **ูููุฏุฉ ุฌุฏุงู** - ุถุฑูุฑูุฉ ูู Health Check Endpoints
- โ **ูุชูุงููุฉ 100%** - ูุง ุชุญุชุงุฌ ุชุนุฏููุงุช
- โ **ุฌุงูุฒุฉ ููุชูููุฐ ุงูููุฑู**

**ุงูุงุณุชุฎุฏุงู ุงูููุชุฑุญ:**
```typescript
// ุฅุถุงูุฉ endpoint ูู routers.ts
health: publicProcedure.query(async () => {
  return await checkDatabaseHealth();
}),
```

**ุงูุฃููููุฉ:** ๐ด **ุนุงุฌู** - ูุฌุจ ุชูููุฐูุง ููุฑุงู

---

### 1.2 `checkDataIntegrity()` โญโญโญโญโญ
**ุงูุบุฑุถ:** ุงูุชุดุงู ูุดุงูู ุงูุจูุงูุงุช

**ุงูุชูููู:**
- โ **ูููุฏุฉ ุฌุฏุงู** - ุชูุชุดู:
  - ุฅูุฑุงุฏุงุช ููุธููู ูุชููุฉ
  - ุชูุงุตูู ุจููุต ูุชููุฉ
  - ููุธููู ุจุฏูู ูุฑุน
  - ุฅูุฑุงุฏุงุช ุณุงูุจุฉ
  - ุจููุต ุฃูุจุฑ ูู ุงูุฅูุฑุงุฏ
- โ๏ธ **ุชุญุชุงุฌ ุชุนุฏูู ุจุณูุท** - ุงุณุชุจุฏุงู `dailyRevenues.totalRevenue` ุจู `dailyRevenues.total`

**ุงูุชุนุฏูู ุงููุทููุจ:**
```typescript
// ุงูุณุทุฑ 282 - ุชุบููุฑ:
.where(sql`${dailyRevenues.totalRevenue} < 0`)
// ุฅูู:
.where(sql`${dailyRevenues.total} < 0`)
```

**ุงูุฃููููุฉ:** ๐ด **ุนุงุฌู** - ุชุดุบูู ูููู ุงูุณุงุนุฉ 3 ุตุจุงุญุงู

---

### 1.3 `getTableStatistics()` โญโญโญโญ
**ุงูุบุฑุถ:** ุชุชุจุน ููู ุงูุจูุงูุงุช

**ุงูุชูููู:**
- โ **ูููุฏุฉ** - ููุชุฎุทูุท ูุงูุฃุฑุดูุฉ
- โ **ูุชูุงููุฉ 100%** - ุงุณุชุนูุงู MySQL ูุจุงุดุฑ
- โ๏ธ **ุชุญุชุงุฌ ุตูุงุญูุงุช** - ูุฑุงุกุฉ `information_schema`

**ุงูุฃููููุฉ:** ๐ข **ููู** - ุชูุงุฑูุฑ ุฃุณุจูุนูุฉ

---

### 1.4 `getSlowQueries()` โญโญโญ
**ุงูุบุฑุถ:** ุชุญุฏูุฏ ุงูุงุณุชุนูุงูุงุช ุงูุจุทูุฆุฉ

**ุงูุชูููู:**
- โ๏ธ **ูููุฏุฉ ุจุดุฑูุท** - ุชุญุชุงุฌ ุชูุนูู `performance_schema`
- โ๏ธ **ูุฏ ูุง ุชุนูู** - ูุนุชูุฏ ุนูู ุฅุนุฏุงุฏุงุช MySQL

**ุงูุฃููููุฉ:** ๐ก **ูุชูุณุท** - ููุชุญุณูู ุงููุณุชูุจูู

---

## 2. ๐ ุงููุทุงุจูุฉ ูุงูุชุณููุฉ (Reconciliation)

### 2.1 `reconcileBranchRevenues()` โญโญโญโญโญ
**ุงูุบุฑุถ:** ุงูุชุฃูุฏ ูู ุชุทุงุจู ุฅูุฑุงุฏุงุช ุงูููุธููู ูุน ุงููุฑุน

**ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ:**
```
โ(ุฅูุฑุงุฏุงุช ุงูููุธููู) = ุฅูุฑุงุฏ ุงููุฑุน ุงููููู
```

**ุงูุชูููู:**
- โ **ุถุฑูุฑูุฉ ุฌุฏุงู** - ูุฐู ูู ุงููุดููุฉ ุงูุฃุณุงุณูุฉ ุงูุชู ูุงุฌููุงูุง!
- โ๏ธ **ุชุญุชุงุฌ ุชุนุฏูู** - ุงุณุชุจุฏุงู `dailyRevenues.totalRevenue` ุจู `dailyRevenues.total`

**ุงูุชุนุฏูู ุงููุทููุจ:**
```typescript
// ุงูุณุทุฑ 538 - ุชุบููุฑ:
sql`${dailyRevenues.totalRevenue} IS NULL OR ${dailyRevenues.totalRevenue} = 0`
// ุฅูู:
sql`${dailyRevenues.total} IS NULL OR ${dailyRevenues.total} = 0`
```

**ุงูุงุณุชุฎุฏุงู ุงูููุชุฑุญ:**
```typescript
// ูุจู ุญุณุงุจ ุงูุจููุต
const result = await reconcileBranchRevenues(branchId, startDate, endDate);
if (!result.isReconciled) {
  throw new Error('ูุง ูููู ุญุณุงุจ ุงูุจููุต - ููุฌุฏ ูุฑููุงุช ูู ุงูุฅูุฑุงุฏุงุช');
}
```

**ุงูุฃููููุฉ:** ๐ด **ุนุงุฌู** - ูุฌุจ ุชุดุบูููุง ูุจู ูู ุญุณุงุจ ุจููุต

---

### 2.2 `reconcileBonusCalculations()` โญโญโญโญโญ
**ุงูุบุฑุถ:** ุงูุชุฃูุฏ ูู ุตุญุฉ ุญุณุงุจ ุงูุจููุต

**ุงูุชูููู:**
- โ **ุถุฑูุฑูุฉ ุฌุฏุงู** - ุชุชุญูู ูู:
  - ุงูุจููุต ูุญุณูุจ ุตุญูุญุงู ุญุณุจ ุงููุณุชููุงุช
  - ุฅุฌูุงูู ุงูุจููุต = ูุฌููุน ุจููุต ุงูููุธููู
  - ูุง ููุฌุฏ ุจููุต ุจุฏูู ุฅูุฑุงุฏ
- โ **ูุชูุงููุฉ 100%** - ุชุณุชุฎุฏู ููุณ ููุงุนุฏ ุงููุณุชููุงุช

**ุงูุฃููููุฉ:** ๐ด **ุนุงุฌู** - ูุจู ุตุฑู ุงูุจููุต

---

### 2.3 `reconcileMonth()` โญโญโญโญโญ
**ุงูุบุฑุถ:** ูุทุงุจูุฉ ุดุงููุฉ ูุดูุฑ ูุงูู

**ุงูุชูููู:**
- โ **ูููุฏุฉ ุฌุฏุงู** - ุชุฌูุน ูู ุงููุทุงุจูุงุช
- โ **ูุชูุงููุฉ** - ุชุณุชุฏุนู ุงูุฏูุงู ุงูุณุงุจูุฉ

**ุงูุงุณุชุฎุฏุงู ุงูููุชุฑุญ:**
- ุฅุบูุงู ุงูุดูุฑ ุงููุงูู
- ุงูุชูุงุฑูุฑ ููุฅุฏุงุฑุฉ
- ุงูุชุฏููู ุงูุฎุงุฑุฌู

**ุงูุฃููููุฉ:** ๐ข **ููู** - ููุงูุฉ ูู ุดูุฑ

---

## 3. ๐ ุฅุฏุงุฑุฉ ุณูุฑ ุงูุนูู (Workflow Management)

### 3.1 `getBonusWorkflowStatus()` โญโญโญโญ
**ุงูุบุฑุถ:** ุชุชุจุน ุญุงูุฉ ุงูุจููุต ุนุจุฑ ูุฑุงุญู ุงูููุงููุฉ

**ุงููุฑุงุญู:**
```
draft โ pending โ under_review โ approved โ paid
                             โ rejected
```

**ุงูุชูููู:**
- โ **ูููุฏุฉ** - ูุชุชุจุน ุญุงูุฉ ุงูุจููุต
- โ๏ธ **ุชุญุชุงุฌ ุชุนุฏูู** - ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ:
  - `approvedBy`
  - `approvedAt`
  - `paidAt`

**ุงูุฃููููุฉ:** ๐ก **ูุชูุณุท** - ุจุนุฏ ุฅุถุงูุฉ ุงูุญููู

---

### 3.2 `transitionBonusStatus()` โญโญโญโญ
**ุงูุบุฑุถ:** ุชุบููุฑ ุญุงูุฉ ุงูุจููุต ูุน ุงูุชุญูู

**ุงูุชูููู:**
- โ **ูููุฏุฉ** - ุชุถูู ุณูุฑ ุงูุนูู ุงูุตุญูุญ
- โ๏ธ **ุชุญุชุงุฌ ุชุนุฏูู** - ุฅุถุงูุฉ ุฌุฏูู `audit_logs`

**ุงูุฃููููุฉ:** ๐ก **ูุชูุณุท**

---

### 3.3 `getPendingTasks()` โญโญโญโญ
**ุงูุบุฑุถ:** ุนุฑุถ ุงูููุงู ุงููุนููุฉ ุญุณุจ ุงูุฏูุฑ

**ุงูุชูููู:**
- โ **ูููุฏุฉ ุฌุฏุงู** - ูููุญุฉ ุชุญูู ุงููุฏูุฑ
- โ **ูุชูุงููุฉ** - ุชุณุชุฎุฏู ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ

**ุงูุฃููููุฉ:** ๐ข **ููู** - ูุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

---

## 4. ๐ ุงูุชุญูููุงุช ูุงูุชูุงุฑูุฑ (Analytics & Reports)

### 4.1 `analyzeEmployeePerformance()` โญโญโญโญโญ
**ุงูุบุฑุถ:** ุชุญููู ุดุงูู ูุฃุฏุงุก ููุธู

**ุงูููุงููุณ:**
- ูุชูุณุท ุงูุฅูุฑุงุฏ ุงููููู/ุงูุฃุณุจูุนู
- ูุนุฏู ุงูุญุตูู ุนูู ุงูุจููุต
- ุงูุงุชุฌุงู (ุตุนูุฏ/ูุจูุท/ุซุจุงุช)
- ุงูุชุฑุชูุจ ูู ุงููุฑุน

**ุงูุชูููู:**
- โ **ูููุฏุฉ ุฌุฏุงู** - ูุชูููู ุงูุฃุฏุงุก
- โ **ูุชูุงููุฉ 100%**

**ุงูุฃููููุฉ:** ๐ข **ููู** - ูุตูุญุฉ ุงูููุธู

---

### 4.2 `analyzeBranchPerformance()` โญโญโญโญโญ
**ุงูุบุฑุถ:** ููุงุฑูุฉ ุฃุฏุงุก ุงููุฑูุน

**ุงูุชูููู:**
- โ **ูููุฏุฉ ุฌุฏุงู** - ููุฅุฏุงุฑุฉ ุงูุนููุง
- โ๏ธ **ุชุญุชุงุฌ ุชุนุฏูู** - ุงุณุชุจุฏุงู `dailyRevenues.totalRevenue` ุจู `dailyRevenues.total`

**ุงูุฃููููุฉ:** ๐ข **ููู** - ูุชูุงุฑูุฑ ุงูุฅุฏุงุฑุฉ

---

### 4.3 `getDataGapsReport()` โญโญโญโญโญ
**ุงูุบุฑุถ:** ุชุญุฏูุฏ ุงูุจูุงูุงุช ุงููุงูุตุฉ

**ุงูุชูููู:**
- โ **ุถุฑูุฑูุฉ** - ูุถูุงู ุงูุชูุงู ุงูุจูุงูุงุช
- โ **ูุชูุงููุฉ 100%**

**ุงูุงุณุชุฎุฏุงู ุงูููุชุฑุญ:**
```typescript
const gaps = await getDataGapsReport(branchId, 1, 2024);
if (gaps.completionRate < 90) {
  await sendAlert('ูุณุจุฉ ุฅุฏุฎุงู ุงูุจูุงูุงุช ููุฎูุถุฉ', gaps);
}
```

**ุงูุฃููููุฉ:** ๐ข **ููู** - ุชุดุบูู ูููู

---

## 5. ๐ก๏ธ ุงููุฑุงุฌุนุฉ ูุงูุงูุชุซุงู (Audit & Compliance)

### 5.1 `logAuditEntry()` โญโญโญโญ
**ุงูุบุฑุถ:** ุชุณุฌูู ุงูุชุบููุฑุงุช ูููุฑุงุฌุนุฉ

**ุงูุชูููู:**
- โ **ูููุฏุฉ** - ููุชุฏููู
- โ๏ธ **ุชุญุชุงุฌ ุฌุฏูู ุฌุฏูุฏ** - `audit_logs`

**ุงูุจุฏูู ุงูููุฌูุฏ:**
- ููุฌุฏ `bonusAuditLog` ู `systemLogs` ู `activityLogs`
- ูููู ุงุณุชุฎุฏุงููุง ุจุฏูุงู ูู ุฅูุดุงุก ุฌุฏูู ุฌุฏูุฏ

**ุงูุฃููููุฉ:** ๐ก **ูุชูุณุท**

---

### 5.2 `getAuditLog()` โญโญโญโญ
**ุงูุบุฑุถ:** ุงุณุชุนุฑุงุถ ุณุฌู ุงูุชุบููุฑุงุช

**ุงูุชูููู:**
- โ **ูููุฏุฉ** - ููุชุญููู ูู ุงููุดุงูู
- โ๏ธ **ุชุญุชุงุฌ ุชุนุฏูู** - ุงุณุชุฎุฏุงู ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ

**ุงูุฃููููุฉ:** ๐ก **ูุชูุณุท**

---

### 5.3 `getComplianceReport()` โญโญโญโญโญ
**ุงูุบุฑุถ:** ุงูุชุญูู ูู ุงูุงูุชุฒุงู ุจุงูุณูุงุณุงุช

**ุงูุชูููู:**
- โ **ูููุฏุฉ ุฌุฏุงู** - ููุงูุชุซุงู
- โ **ูุชูุงููุฉ 100%**

**ุงูููุงููุณ:**
- ุญุณุงุจ ุงูุจููุต ูู ุงูููุช ุงููุญุฏุฏ
- ุงูููุงููุงุช ุงูุตุญูุญุฉ
- ุงูุชูุงู ุฅุฏุฎุงู ุงูุจูุงูุงุช

**ุงูุฃููููุฉ:** ๐ข **ููู** - ุชูุงุฑูุฑ ุฃุณุจูุนูุฉ

---

## ๐ ุฎุทุฉ ุงูุชูููุฐ ุงูููุชุฑุญุฉ

### ุงููุฑุญูุฉ 1: ุนุงุฌู (ูุฐุง ุงูุฃุณุจูุน)
1. โ `checkDatabaseHealth()` - ุฅุถุงูุฉ endpoint
2. โ `checkDataIntegrity()` - ูุน ุงูุชุนุฏููุงุช
3. โ `reconcileBranchRevenues()` - ูุน ุงูุชุนุฏููุงุช
4. โ `reconcileBonusCalculations()` - ููุง ูู

### ุงููุฑุญูุฉ 2: ููู (ุงูุฃุณุจูุน ุงููุงุฏู)
1. `analyzeEmployeePerformance()` - ูุตูุญุฉ ุงูููุธู
2. `analyzeBranchPerformance()` - ูุชูุงุฑูุฑ ุงูุฅุฏุงุฑุฉ
3. `getDataGapsReport()` - ููุชูุจููุงุช
4. `getComplianceReport()` - ููุงูุชุซุงู

### ุงููุฑุญูุฉ 3: ุชุญุณููุงุช (ุงูุดูุฑ ุงููุงุฏู)
1. `getBonusWorkflowStatus()` - ุจุนุฏ ุฅุถุงูุฉ ุงูุญููู
2. `transitionBonusStatus()` - ูุน ูุธุงู ุงููุฑุงุฌุนุฉ
3. `getPendingTasks()` - ูููุญุฉ ุงูุชุญูู
4. `getTableStatistics()` - ููุชุฎุทูุท

---

## ๐ง ุงูุชุนุฏููุงุช ุงููุทููุจุฉ ุนูู ุงูููู

### 1. ุงุณุชุจุฏุงู `totalRevenue` ุจู `total`
```typescript
// ุฌููุน ุงูุฃูุงูู ุงูุชู ุชุณุชุฎุฏู dailyRevenues.totalRevenue
// ูุฌุจ ุชุบููุฑูุง ุฅูู dailyRevenues.total
```

### 2. ุงุณุชุจุฏุงู `auditLogs` ุจุงูุฌุฏุงูู ุงูููุฌูุฏุฉ
```typescript
// ุงุณุชุฎุฏุงู bonusAuditLog ุฃู systemLogs ุฃู activityLogs
// ุจุฏูุงู ูู ุฅูุดุงุก ุฌุฏูู ุฌุฏูุฏ
```

### 3. ุฅุถุงูุฉ ุงูุงุณุชูุฑุงุฏุงุช ุงููุงูุตุฉ
```typescript
import { bonusAuditLog, systemLogs, activityLogs } from "../../drizzle/schema";
```

---

## ๐ ุงูุฎูุงุตุฉ

| ุงููููุงุณ | ุงููููุฉ |
|---------|--------|
| ุฅุฌูุงูู ุงูุฏูุงู | 18 |
| ุฌุงูุฒุฉ ููุชูููุฐ ุงูููุฑู | 8 |
| ุชุญุชุงุฌ ุชุนุฏููุงุช ุจุณูุทุฉ | 6 |
| ุชุญุชุงุฌ ุชุนุฏููุงุช ูุจูุฑุฉ | 4 |
| **ูุณุจุฉ ุงูุชูุงูู** | **78%** |

**ุงูุชูุตูุฉ ุงูููุงุฆูุฉ:**
ูุฐู ุงูุฏูุงู **ููููุฉ ุฌุฏุงู** ูุณุชุญู ูุดุงูู ุญููููุฉ ูู ุงููุธุงู. ูููุตุญ ุจุชูููุฐ ุงููุฑุญูุฉ ุงูุฃููู ููุฑุงูุ ุฎุงุตุฉ ุฏูุงู ุงููุทุงุจูุฉ ุงูุชู ุณุชููุน ูุดุงูู ุญุณุงุจ ุงูุจููุต ูุณุชูุจูุงู.
